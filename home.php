<?php
include 'sessioncheck.php';
include_once 'profilepicture.php';
include_once 'displayposts.php';
?>
<!DOCTYPE html>
<html lang = "en">

<header>
<?php
if(!preg_match("/(android|avantgo|blackberry|bolt|boost|cricket|docomo|fone|hiptop|mini|mobi|palm|phone|pie|tablet|up\.browser|up\.link|webos|wos)/i", $_SERVER["HTTP_USER_AGENT"])) {
	echo "<script src='sparkles.js'></script><span class='js-cursor-container'></span>";
?>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/> 
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/> 
    <meta name="apple-mobile-web-app-capable" content="yes"/> 
    <link href="seattlesnowflake/resources/css/jquery-ui-themes.css" type="text/css" rel="stylesheet"/> 
    <link href="seattlesnowflake/resources/css/axure_rp_page.css" type="text/css" rel="stylesheet"/> 
    <link href="seattlesnowflake/data/styles.css" type="text/css" rel="stylesheet"/> 
    <link href="seattlesnowflake/files/home/styles.css" type="text/css" rel="stylesheet"/> 
    <script src="seattlesnowflake/resources/scripts/jquery-1.7.1.min.js"></script> 
    <script src="seattlesnowflake/resources/scripts/jquery-ui-1.8.10.custom.min.js"></script> 
    <script src="seattlesnowflake/resources/scripts/prototypePre.js"></script> 
    <script src="seattlesnowflake/data/document.js"></script> 
    <script src="seattlesnowflake/resources/scripts/prototypePost.js"></script> 
    <script src="seattlesnowflake/files/home/data.js"></script>
<script type="text/javascript"> 
      $axure.utils.getTransparentGifPath = function() { return 'seattlesnowflake/resources/images/transparent.gif'; }; 
      $axure.utils.getOtherPath = function() { return 'seattlesnowflake/resources/Other.html'; }; 
      $axure.utils.getReloadPath = function() { return 'seattlesnowflake/resources/reload.html'; }; 
    </script> 
<div id="base" class=""> 
 
      <!-- lbltime (Rectangle) --> 
      <div id="u0" class="ax_default label" data-label="lbltime"> 
        <div id="u0_div" class=""></div> 
        <div id="u0_text" class="text "> 
          <p><span>0</span></p> 
        </div> 
      </div> 
 
      <!-- Unnamed (Dynamic Panel) --> 
      <div id="u1" class="ax_default"> 
        <div id="u1_state0" class="panel_state" data-label="snowflake" style=""> 
          <div id="u1_state0_content" class="panel_state_content"> 
 
            <!-- Unnamed (Group) --> 
            <div id="u2" class="ax_default" data-left="0" data-top="0" data-width="594" data-height="639.5"> 
 
              <!-- Unnamed (Ellipse) --> 
              <div id="u3" class="ax_default ellipse"> 
                <img id="u3_img" class="img " src="seattlesnowflake/images/home/u3.png"/> 
              </div> 
 
              <!-- Unnamed (Rectangle) --> 
              <div id="u4" class="ax_default box_1"> 
                <div id="u4_div" class=""></div> 
              </div> 
 
              <!-- Unnamed (Rectangle) --> 
              <div id="u5" class="ax_default box_1"> 
                <div id="u5_div" class=""></div> 
              </div> 
 
              <!-- Unnamed (Rectangle) --> 
              <div id="u6" class="ax_default box_1"> 
                <div id="u6_div" class=""></div> 
              </div> 
 
              <!-- Unnamed (Rectangle) --> 
              <div id="u7" class="ax_default box_1"> 
                <div id="u7_div" class=""></div> 
              </div> 
<!-- Unnamed (Rectangle) --> 
              <div id="u8" class="ax_default box_1"> 
                <div id="u8_div" class=""></div> 
              </div> 
 
              <!-- Unnamed (Rectangle) --> 
              <div id="u9" class="ax_default box_1"> 
                <div id="u9_div" class=""></div> 
              </div> 
 
              <!-- Unnamed (Rectangle) --> 
              <div id="u10" class="ax_default box_1"> 
                <div id="u10_div" class=""></div> 
              </div> 
 
              <!-- Unnamed (Rectangle) --> 
              <div id="u11" class="ax_default box_1"> 
                <div id="u11_div" class=""></div> 
              </div> 
            </div> 
          </div> 
        </div> 
        <div id="u1_state1" class="panel_state" data-label="cross" style="visibility: hidden;"> 
          <div id="u1_state1_content" class="panel_state_content"> 
 
            <!-- Unnamed (Rectangle) --> 
            <div id="u12" class="ax_default box_1"> 
              <div id="u12_div" class=""></div> 
            </div> 
 
            <!-- Unnamed (Rectangle) --> 
            <div id="u13" class="ax_default box_1"> 
              <div id="u13_div" class=""></div> 
            </div> 
 
            <!-- Unnamed (Rectangle) --> 
            <div id="u14" class="ax_default box_1"> 
              <div id="u14_div" class=""></div> 
            </div> 
 
            <!-- Unnamed (Rectangle) --> 
            <div id="u15" class="ax_default box_1"> 
              <div id="u15_div" class=""></div> 
            </div> 
 
            <!-- Unnamed (Rectangle) --> 
            <div id="u16" class="ax_default box_1"> 
              <div id="u16_div" class=""></div> 
            </div> 
 <!-- Unnamed (Rectangle) --> 
            <div id="u17" class="ax_default box_1"> 
              <div id="u17_div" class=""></div> 
            </div> 
 
            <!-- Unnamed (Rectangle) --> 
            <div id="u18" class="ax_default box_1"> 
              <div id="u18_div" class=""></div> 
            </div> 
 
            <!-- Unnamed (Rectangle) --> 
            <div id="u19" class="ax_default box_1"> 
              <div id="u19_div" class=""></div> 
            </div> 
 
            <!-- Unnamed (Rectangle) --> 
            <div id="u20" class="ax_default box_1"> 
              <div id="u20_div" class=""></div> 
            </div> 
 
            <!-- Unnamed (Rectangle) --> 
            <div id="u21" class="ax_default box_1"> 
              <div id="u21_div" class=""></div> 
            </div> 
 
            <!-- Unnamed (Rectangle) --> 
            <div id="u22" class="ax_default box_1"> 
              <div id="u22_div" class=""></div> 
            </div> 
 
            <!-- Unnamed (Rectangle) --> 
            <div id="u23" class="ax_default box_1"> 
              <div id="u23_div" class=""></div> 
            </div> 
          </div> 
        </div> 
      </div> 
    </div> 
<?php
}
?>
<script>
        function likePost(id,type,poster,compID) {
            var button = document.getElementById("likeButton" + compID);
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open("GET", "likepost.php?id=" + id + "&type=" + type + "&poster=" + poster);
            xmlhttp.send();
            button.id="unlikeButton"+compID;
            button.innerHTML="liked";
            button.onclick= function(){unlikePost(type,id,poster,compID);}
// window.location.href = "likepost.php?id=" + id + "&type=" + type + "&poster=" + poster;
        }
        function unlikePost(type,id,user,compID) {
            var button = document.getElementById("unlikeButton" + compID);
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open("GET", "unlikepost.php?postID=" + id + "&posttype=" + type + "&user=" + user);
            xmlhttp.send();
            button.innerHTML="like";
            button.id="likeButton"+compID;
            button.onclick=function(){likePost(id,type,user,compID);}
            
        }
        function goToDist() {
            window.location.href="distanceform1.php";
        }
        function goToRace() {
            window.location.href="raceform.php";
        }
        function goToSpeed() {
            window.location.href="speedform1.php";
        }
</script>
    <link rel="stylesheet" media="screen and (max-width: 550px)" type="text/css" href="css/400.php" />
<link rel="stylesheet" media="screen and (min-width: 550px)" type="text/css" href="css/styles.php"/>

<div class='bodydiv'>
<title>RunnersNet</title>
<!--News Feed
    This will display posts from posts, pageposts, distance, and races where the poster is a friend -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <div class="titlediv">
        <?php
        include 'menu.php';
        // echo "here";
        echo "</div>";
        $type = (isset($_GET['type'])) ? $_GET['type'] : null;
        $postID = (isset($_GET['id'])) ? $_GET['id'] : null;
        $posttype = (isset($_GET['ptype'])) ? $_GET['ptype'] : null;
        $otherPerson = (isset($_GET['person'])) ? $_GET['person'] : null;
        // echo $type." ".$postID." ".$posttype;
        $feed = array();
        $friends = array();
        $friendindex = 0;
        $feedindex = 0;
        $basic = array();
        //get user's basic info
        if ($call = mysqli_query($db, "CALL GetBasicInfo($cid)")) {
            while ($row = mysqli_fetch_array($call)) {
                $basic[0] = $row[5];
                $basic[1] = $row[6];
            }
            $call->free();
            $db->next_result();
        } else {
            echo " basic ".mysqli_error($db);
        }
        if ($call = mysqli_query($db, "CALL GetFriends($cid)")) {
            while ($row = mysqli_fetch_array($call, MYSQLI_BOTH)) {
                if ($row['person1'] == $cid) {
                    $friends[$friendindex] = $row['person2'];
                } else {
                    $friends[$friendindex] = $row['person1'];
                }
                $friendindex++;
            }
            $call->free();
            $db->next_result();
        } else {
            echo mysqli_error($db);
        }
        if ($call = mysqli_query($db, "CALL GETMYGROUPS($cid)")) {
            
            while ($row = mysqli_fetch_array($call, MYSQLI_BOTH)) {
                $friends[$friendindex] = $row['groupID'];
                                    
                $friendindex++;                   
            }
            $call->free();
            $db->next_result();
        }
        // echo "here";
        if ($type != "view") { //this checks if this page is being used to view an individual post
            
            $diststmt = $db->prepare("CALL GETDISTANCE(?)");
            $racestmt = $db->prepare("CALL GETRACES(?)");
            $poststmt = $db->prepare("CALL GETUSERPOSTS(?)");
            $pgpoststmt = $db->prepare("CALL GETPAGEPOSTS(?)");
            $repoststmt = $db->prepare("CALL GETREPOSTS(?)");
            $speedstmt = $db->prepare("CALL GETSPEED(?)");
            
            $limstmt = $db->prepare("CALL GETLIMITS(?)");
                $limstmt->bind_param("i", $cid);
		$limstmt->execute();
		$result = $limstmt->get_result();
		$hasLimit = false;
        while ($row = $result->fetch_assoc()) {
            $hasLimit = true;
            $dist10 = $row['distanceLoad'];
            $distLimit = $row['distanceEntries'];
            $speed10 = $row['speedLoad'];
            $speedLimit = $row['speedEntries'];
            $race10 = $row['raceLoad'];
            $raceLimit = $row['raceEntries'];
            $pagePost10 = $row['pagePostLoad'];
            $pagePostLimit = $row['pagePostEntries'];
            $grpPagePost10 = $row['grpPagePostLoad'];
            $grpPagePostLimit = $row['grpPagePostEntries'];
            $post10 = $row['postLoad'];
            $postLimit = $row['postEntries'];
		    $grpPost10 = $row['grpPostsLoad'];
            $grpPostLimit = $row['grpPostEntries'];
        }
        if ($hasLimit) {

            if ($post10 == 1) {
                $post10 = true;
            } else {
                $post10 = false;
            }
            if ($dist10 == 1) {
                $dist10 = true;
            } else {
                $dist10 = false;
            }

            if ($speed10 == 1)
                $speed10 = true;
            else
                $speed10 = false;

            if ($race10 == 1)
                $race10 = true;
            else
                $race10 = false;

            if ($pagePost10 == 1)
                $pagePost10 = true;
            else
                $pagePost10 = false;

            if ($grpPagePost10 == 1)
                $grpPagePost10 = true;
            else
                $grpPagePost10 = false;

            if ($grpPost10 == 1)
                $grpPost10 = true;
            else
                $grpPost10 = false;
            
        }
        

        $db->next_result();
		$fid = 0;
                // echo "here";
                include "feedloader.php";
                $loader = new FeedLoader();
                for ($i = 0; $i < $friendindex; $i++) { //get each friends' posts
                    $fid = $friends[$i];
        
                    // echo "here";
        
                    // echo "here";
                
                    list($feed, $feedindex) = $loader->loadFeed($fid, $feed, $feedindex, $speedstmt, $diststmt, $racestmt, $poststmt, $pgpoststmt, $repoststmt, $db);
                
        
                }
                //get this user's post
            
                list($feed, $feedindex) = $loader->loadFeed($cid, $feed, $feedindex, $speedstmt, $diststmt, $racestmt, $poststmt, $pgpoststmt, $repoststmt, $db);
            
                unset($loader);
                // echo "here";
    
            ?>
        </header>
            <div class="creatingpost">
                <div class="menubuttons">
                    <input type="button" class="redirect" value="Distance Run" id="dist" onclick="goToDist()">
                    <input type="button" class="redirect" id="speed" value="Speed Workout" onclick="goToSpeed()">
                    <input type="button" class="redirect" id="race" value="Race" onclick="goToRace()">
                </div>

                    <div class="opentext">
                        <form id="textform" name="textform" method="post" action="textpost.php" enctype="multipart/form-data">
                            <textarea id="content" rows="3" cols = "50" name="content" placeholder="Say it here"></textarea>
                            <div class="postbuttons">
                                <input type="file" aria-label="Picture/" name="fileToUpload" id="fileToUpload">
                                <input type="hidden" value='3' name='type' id='type'>
                                <input type="hidden" value='<?php echo $cid; ?>' name="encid" id="encid">
                                <input type="hidden" value="0" name="page" id="page">
                                <input type="submit" name="btnSubmitText" id="btnSubmitText" value="Post">
                            </div>
                        </form>
                    </div>
                </div>
                
                    <?php
                } else {
                    
                    $canView = false;
                    $z = 0;
                    
                    //echo "<br><br>".$friendindex;
                    echo "<br><br><br>";
                    while ($z < $friendindex && $canView == false) {
                        
                        if ($otherPerson == $friends[$z] || $otherPerson == $cid)
                            $canView = true;
                        else
                            $z++;
                    }
                    if ($canView == false) {
                        echo "<p>You are not authorized<br>to view this content</p>";
                    } else {
                        // echo "here";
                        if ($posttype == 0) {
                            
                            if ($call = mysqli_query($db, "CALL GETDISTANCEENTRY($postID)")) {
                                while ($row = mysqli_fetch_array($call, MYSQLI_BOTH)) {
                                    $feed[$feedindex]['type'] = $row['type'];
                                    $feed[$feedindex]['userID'] = $row['userID'];
                                    $feed[$feedindex]['public'] = 1;
                                    $feed[$feedindex]['date'] = $row['date'];
                                    $feed[$feedindex]['location'] = $row['location'];
                                    $feed[$feedindex]['team'] = $row['team'];
                                    $feed[$feedindex]['intensity'] = $row['intensity'];
                                    $feed[$feedindex]['journal'] = $row['journal'];
                                    $feed[$feedindex]['runtime'] = $row['runtime'];
                                    $feed[$feedindex]['pace'] = $row['pace'];
                                    $feed[$feedindex]['id'] = $row['id'];
                                    $feed[$feedindex]['distance'] = $row['distance'];

                                    $feedindex++; //increment
                                }
                                
                            } else {
                                    echo mysqli_error($db);
                                }
                                $call->free();
                                $db->next_result();
                        } else if ($posttype == 2) {
                            if ($call = mysqli_query($db, "CALL GETRACEENTRY($postID)")) {
                                while ($row = mysqli_fetch_array($call, MYSQLI_BOTH)) {
                                    $feed[$feedindex]['type'] = $row['type'];
                                    $feed[$feedindex]['userID'] = $row['userID'];
                                    $feed[$feedindex]['id'] = $row['id'];
                                    $feed[$feedindex]['date'] = $row['date'];
                                    $feed[$feedindex]['distance'] = $row['distance'];
                                    $feed[$feedindex]['location'] = $row['location'];
                                    $feed[$feedindex]['racename'] = $row['racename'];
                                    $feed[$feedindex]['relay'] = $row['relay'];
                                    $feed[$feedindex]['runtime'] = $row['runtime'];
                                    $feed[$feedindex]['pace'] = $row['pace'];
                                    $feed[$feedindex]['journal'] = $row['journal'];

                                    $feedindex++; //increment
                                }
                                $call->free();
                                $db->next_result();
                            } else {
                                    echo mysqli_error($db);
                            }
                        } else if ($posttype == 1) {
                            if ($call = mysqli_query($db, "CALL GETSPEEDENTRY($postID)")) {
                                while ($row = mysqli_fetch_array($call, MYSQLI_BOTH)) {
                                    $feed[$feedindex]['type'] = $row['type'];
                                    $feed[$feedindex]['id'] = $row['id'];
                                    $feed[$feedindex]['userID'] = $row['userID'];
                                    $feed[$feedindex]['location'] = $row['location'];
                                    $feed[$feedindex]['date'] = $row['date'];
                                    $feed[$feedindex]['description'] = $row['description'];
                                    $feed[$feedindex]['distance'] = $row['distance'];
                                    $feed[$feedindex]['team'] = $row['team'];
                                    $feed[$feedindex]['journal'] = $row['journal'];
                                    $feed[$feedindex]['public'] = 1;
            
                                    $feedindex++;
                                }
                                $call->free();
                                $db->next_result();
                            } else {
                                echo "speed ".mysqli_error($db);
                            }
                        } else if ($posttype == 3 || $posttype == 6 || $posttype == 9) {

                            if ($call = mysqli_query($db, "CALL GETEXACTPOST($postID)")) {
                                while ($row = mysqli_fetch_array($call, MYSQLI_BOTH)) {

                                    //load into feed array
                                    $feed[$feedindex]['type'] = $row['type'];
                                    $feed[$feedindex]['userID'] = $row['userID'];
                                    $feed[$feedindex]['id'] = $row['id'];
                                    $feed[$feedindex]['date'] = $row['date'];
                                    $feed[$feedindex]['text'] = $row['text'];
                                    $feed[$feedindex]['img'] = $row['img_filepath'];

                                    $feedindex++; //increment
                                }

                                $call->free();
                                $db->next_result();
                            } else {
                                echo mysqli_error($db);
                            }
                        } else if ($posttype == 4 || $posttype == 7) {
                        
                            if ($call = mysqli_query($db, "CALL GETEXACTPAGEPOST($postID)")) {

                                while ($row = mysqli_fetch_array($call, MYSQLI_BOTH)) {
                                    //echo "hi";

                                    //LOAD into feed array
                                    $feed[$feedindex]['type'] = $row['type'];
                                    $feed[$feedindex]['userID'] = $row['poster'];
                                    $feed[$feedindex]['postee'] = $row['postee'];
                                    $feed[$feedindex]['date'] = $row['date'];
                                    $feed[$feedindex]['id'] = $row['id'];
                                    $feed[$feedindex]['text'] = $row['text'];
                                    $feed[$feedindex]['img'] = $row['img_filepath'];

                                    $feedindex++; //increment
                                }

                                $call->free();
                                $db->next_result();
                            } else {
                                echo mysqli_error($db);
                            }
                        } 
                    }
                }
                echo "<div class='newsfeed'>";                
                
                function datesort($a, $b) {
                    if ($a == $b)
                        return 0;
                    return strtotime($a['date']) < strtotime($b['date']);
                }
                include "elapsedtime.php";
                $time_elapse = array();
                
                usort($feed, "datesort");
                $postCount = 0;
                $grpPagePostCount = 0;
                $pagePostCount = 0;                 
                $distCount = 0;
                $raceCount = 0;
                $speedCount = 0;
                
                $i = 0;
                
                //unwrap the news feed
                $basicinfo = $db->prepare("CALL GETBASICINFO(?)");
                $comstmt = $db->prepare("CALL GETCOMMENTS(?,?)");
                $likestmt = $db->prepare("CALL GETLIKES(?,?)");
                $groupstmt = $db->prepare("CALL GETGROUPINFO(?)");
                //$groupstmt->bind_param("i", $poster);
                $comstmt->bind_param("ii", $type, $postID);
                while ($i < $feedindex) {

                    $toDisplay = true;
                    //get the basic info of the poster
                    $postID = $feed[$i]['id'];
                    $poster = $feed[$i]['userID'];
                    $type = $feed[$i]['type'];
                    $pfirstname;
                    $plastname;
                    $posterprofpic;
                    
                    $basicinfo->bind_param("i", $poster);
                    $basicinfo->execute();
                    $result = $basicinfo->get_result();
                    
                    $human = false;
                    while ($row = $result->fetch_assoc()) {
                        
                        $pfirstname = $row['firstname'];
                        $plastname = $row['lastname'];
                        $posterprofpic = $row['img_filepath'];
                        $human = true;
                    }
                    $db->next_result();
                    
                    if (!$human) {
                        
                        $groupstmt->bind_param("i", $poster);
                        $groupstmt->execute();
                        $result = $groupstmt->get_result();
                        
                        while ($row = $result->fetch_assoc()) {
                            $pfirstname = $row['name'];
                            $plastname = "";
                            $posterprofpic = $row['img_filepath'];
                        }
                        $db->next_result();
                    }
                    $cind = 0;
                    $comment = array();
                    
                    //$comstmt->bind_param("ii", $type, $postID);
                    $comstmt->execute();
                    $result = $comstmt->get_result();
                    
                        
                    while ($row = $result->fetch_assoc()) {
                        
                        $comment[$cind]['type'] = $row['type'];
                        $comment[$cind]['posttype'] = $row['posttype'];
                        $comment[$cind]['postID'] = $row['postID'];
                        $comment[$cind]['id'] = $row['commentID'];
                        $comment[$cind]['date'] = $row['date'];
                        $comment[$cind]['userID'] = $row['userID'];
                        $comment[$cind]['text'] = $row['text'];
                        $comment[$cind]['img_filepath'] = $row['img_filepath'];
                        $cind++;
                    }
                    $db->next_result();
                        
                    $comm = true;
                    if ($cind == 0) {
                        $comm = false;
                    }

                    for ($ci = 0; $ci < $cind; $ci++) {
                        $comment[$ci]['time_elapsed'] = elapsedtime::getElapsedTime($comment[$ci]['date']);
                    }


                    //get the likes for the post
                    $like = array(); //ID of the like
                    $likeIndex = 0;

                    if ($call = mysqli_query($db, "CALL GetLikes($type, $postID)")) {
                        // echo "here";
                        while ($row = mysqli_fetch_array($call, MYSQLI_BOTH)) {
                            //$like[$likeIndex]['id'] = $row['id'];
                            $like[$likeIndex]['posterID'] = $row['posterID'];
                            $like[$likeIndex]['likerID'] = $row['likerID'];
                            $like[$likeIndex]['date'] = $row['date'];

                            $likeIndex++;
                            // echo "here1";
                        }
                        // echo " there";
                        $call->free();
                        $db->next_result();
                    } else {
                        echo "Likes ".mysqli_error($db);
                    }
                    $isLiked = false;
                    if ($likeIndex > 0) {
                        $isLiked = true;
                    }

                    //find out if tihs user has liked the post
                    $userLike = false;
                    $li = 0;

                    // echo "here";
                    while ($li < $likeIndex && $userLike == false) {
                        if ($like[$li]['likerID'] == $cid) {
                            $userLike = true;
                            // echo "yes";
                        }
                        $li++;
                    }



                    $time_elapse[$i] = elapsedtime::getElapsedTime($feed[$i]['date']);
                    $strinten;
                    
                    $relay;
                    if (intval($feed[$i]['type']) == 3) { //POST results

                    if ($hasLimit) {
                        if ($post10) {
                            if ($postCount < $postLimit) {
                                $postCount++;
                                $toDisplay = true;
                            } else {
                                $toDisplay = false;
                            }
                        } else {
                            $toDisplay = false;
                        }
                    }
                    if ($toDisplay)    
                        DisplayPosts::displayRegPosts($feed, $i, $userLike, $posterprofpic, $pfirstname, $plastname, $time_elapse, $poster, $type, $postID, $comm, $comment, $cind, $likeIndex, $basicinfo, $comstmt, $likestmt, $db, $cid);


                    } elseif ($feed[$i]['type'] == 6 && $feed[$i]['poster'] == null) { //video formatting from posts table



                    } elseif ($feed[$i]['type'] == 6 && $feed[$i]['poster'] != null) { //video formatting from pageposts table
                        $known = false;
                        $search = 0;
                        $userID = $feed[$i]['userID'];

                        while ($known == false && $search < $friendindex + 1) {
                            if ($friends[$search] == $userID || $userID == $cid) {
                                $known = true;
                            } else {
                                $search++;
                            }
                        }
                        // echo "there";
                        if ($known == true) {
                            // echo "yes";

                            $postee = $feed[$i]['postee'];
                            $posteefname;
                            $posteelname;
                            $posteepic;
                            $basicinfo->bind_param("i", $postee);
                            $basicinfo->execute();
                            $result = $basicinfo->get_result();
                    
                            while ($row = $result->fetch_assoc()) {
                                $posteefname = $row['firstname'];
                                $posteelname = $row['lastname'];
                                $posteepic = $row['img_filepath'];
                            }
                            $db->next_result();
                            // echo $posteefname;

                            //$display = new DislayPosts();
                            if ($hasLimit) {
                                if ($pagePost10) {
                                    if ($pagePostCount < $pagePostLimit) {
                                        $pagePostCount++;
                                        $toDisplay = true;
                                    } else {
                                        $toDisplay = false;
                                    }
                                } else {
                                    $toDisplay = false;
                                }
                            }
                            if ($toDisplay)
                                DisplayPosts::displayPagePosts($posteefname, $posteelname, $posteepic, $feed, $i, $userLike, $posterprofpic, $pfirstname, $plastname, $time_elapse, $poster, $postee, $type, $postID, $comm, $comment, $cind, $likeIndex, $basicinfo, $comstmt, $likestmt, $db);
                        }


                    } elseif ($feed[$i]['type'] == 2) { //RACES
                        
                        if ($hasLimit) {
                            if ($race10) {
                                if ($raceCount < $raceLimit) {
                                    $raceCount++;
                                } else {
                                    $toDisplay = false;
                                }
                            } else {
                                $toDisplay = false;
                            }
                        }
                        if ($toDisplay)            
                            DisplayPosts::displayRaces($posterprofpic, $pfirstname, $plastname, $i, $feed, $basic, $time_elapse, $userLike, $postID, $type, $poster, $comm, $comment, $call, $db, $cid, $cind, $basicinfo, $comstmt, $likestmt, $groupstmt);

                    } elseif (($feed[$i]['type'] == 0 || $feed[$i]['type'] == 1) && $feed[$i]['public'] == 1) { //distance
                        if ($feed[$i]['public'] == 1) {
                            
                            if ($hasLimit && $feed[$i]['type'] == 0) {
                                if ($dist10) {
                                    if ($distCount < $distLimit) {
                                        $distCount++;
                                    } else {
                                        $toDisplay = false;
                                    }
                                } else {
                                    $toDisplay = false;
                                }
                            } elseif ($hasLimit && $feed[$i]['type'] == 1) {
                                if ($speed10) {
                                    if ($speedCount < $speedLimit) {
                                        $speedCount++;
                                    } else {
                                        $toDisplay = false;
                                    }
                                } else {
                                    $toDisplay = false;
                                }
                            }
                            if ($toDisplay)
                                DisplayPosts::displayDistanceRuns($feed, $i, $userLike, $posterprofpic, $pfirstname, $plastname, $time_elapse, $poster, $type, $postID, $comm, $comment, $cind, $likeIndex, $basicinfo, $comstmt, $likestmt, $db, $cid, $groupstmt);
                        }

                    } elseif ($feed[$i]['type'] == 4 || $feed[$i]['type'] == 7) { //PAGEPOSTS (a post from one user onto another
                        //[both must be friends of this user to appear here])
                        // echo "here";

                        $known = false;
                        $search = 0;
                        $userID = $feed[$i]['userID'];

                        while ($known == false && $search < $friendindex + 1) {
                            if ($friends[$search] == $userID || $userID == $cid) {
                                $known = true;
                            } else {
                                $search++;
                            }
                        }
                        // echo "there";
                        if ($known == true) {
                            // echo "yes";

                            $postee = $feed[$i]['postee'];
                            $posteefname;
                            $posteelname;
                            $posteepic;
                            if ($feed[$i]['type'] == 4) {
                                $basicinfo->bind_param("i", $postee);
                                $basicinfo->execute();
                                $result = $basicinfo->get_result();
                                
                                
                                while ($row = $result->fetch_assoc()) {
                                    $posteefname = $row['firstname'];
                                    $posteelname = $row['lastname'];
                                    $posteepic = $row['img_filepath'];
                                }
                                
                                $db->next_result();
                                
                            } elseif ($feed[$i]['type'] == 7) {
                                $groupstmt->bind_param("i", $postee);
                                $groupstmt->execute();
                                $result = $groupstmt->get_result();
                                while ($row = $result->fetch_assoc()) {
                                    $posteefname = $row['name'];
                                    $posteelname = "";
                                    $posteepic = $row['img_filepath'];
                                }
                                $db->next_result();
                            }
                            // echo $posteefname;

                            //$display = new DislayPosts();
                            if ($hasLimit) {
                                if ($feed[$i]['type'] == 4) {
                                    if ($pagePost10) {
                                        if ($pagePostCount < $pagePostLimit) {
                                            $pagePostCount++;
                                        } else {
                                            $toDisplay = false;
                                        }
                                    } else {
                                        $toDisplay = false;
                                    }
                                } else {
                                    if ($grpPagePost10) {
                                        if ($grpPagePostCount < $grpPagePostLimit) {
                                            $grpPagePostCount++;
                                        } else {
                                            $toDisplay = false;
                                        }
                                    } else {
                                        $toDisplay = false;
                                    }
                                }
                            }
                            if ($toDisplay)                      
                                DisplayPosts::displayPagePosts($posteefname, $posteelname, $posteepic, $feed, $i, $userLike, $posterprofpic, $pfirstname, $plastname, $time_elapse, $poster, $postee, $type, $postID, $comm, $comment, $cind, $likeIndex, $basicinfo, $comstmt, $likestmt, $db, $groupstmt, $cid);
                        }

                    } elseif ($feed[$i]['type'] == 9) {
                        if ($hasLimit) {
                            if ($grpPost10) {
                                if ($grpPostCount < $grpPostLimit) {
                                    $grpPostCount++;
                                } else {
                                    $toDisplay = false;
                                }
                            } else {
                                $toDisplay = true;
                            }
                        }
                        if ($toDisplay)         
                            DisplayPosts::displayGroupPosts($posterprofpic, $time_elapse, $pfirstname, $feed, $userLike, $postID, $type, $poster, $i, $db, $basicinfo, $comment, $groupstmt, $cid, $comm, $cind);
                    }


                    $i++;
       }
       unset($basicinfo);
       unset($groupstmt);
       unset($likestmt);
       unset($comstmt);
       unset($feed);
       unset($friends);
       unset($basic);
       unset($like);
       unset($time_elapse);
       unset($comment);
       unset($result);
       unset($row);
       
       
    ?>
	</body>
    </div>
    </html>
